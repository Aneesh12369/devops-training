pipeline {
    
    agent any
    
    options {
        disableConcurrentBuilds()
    }
    
    stages {
        
        stage('Build') {
        	steps {
	            sh 'mvn -f spring-boot-demo/pom.xml clean install -DskipTests'
	        }   
        }
        
        stage('Unin Tests') {
        	steps {
	            sh 'mvn -f spring-boot-demo/pom.xml clean install'
	        }   
        }
        
        stage('Sonar Scan') {
        	steps{
            	env.sonarHome = tool name: 'sonar-scanner', type: 'hudson.plugins.sonar.SonarRunnerInstallation'
    			withSonarQubeEnv('sonar-server') {
      					sh "${scannerHome}/bin/sonar-scanner"    
        		}
        			
        		timeout(time: 5, unit: 'MINUTES') { 
    				waitForQualityGate abortPipeline: true
  				}
            
        	}
        	
    	}
    	
    	stage('Build Docker Image') {
    		steps{
				println "Building image"
			}
    	
    	}
    	
    	stage('Publish to DockerHub') {
			steps{	
				println "Pushing Image to Docker Hub"
			}
    	
    	}
    	
    	stage('Deploy') {
    		steps{
    	    	println "Deploying.."
    		}
    	
    	}
    	
    	
    }
}